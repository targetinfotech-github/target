{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
    <style>
        .form-control {
            width: 10vw;
            height: 30px;
            padding: 5px;
            font-size: 12px;
            color: #0a0a0a;
            font-weight: bold;
        }

        .form-errors .alert {
            color: #fff;
            background-color: #dc3545;
            border-color: #dc3545;
            padding: 0.75rem 1.25rem;
            margin-bottom: 1rem;
        }

        .form-errors .alert p {
            margin: 0;
            padding: 0;
            font-size: 0.875em;
        }


        #form_submit {
            display: block;
            margin-top: 1rem;
        }

        .form-error-alert {
            height: 40px;
            background-color: #f2dede;
            padding-top: 0;
            padding-bottom: 0;

            color: #a94442;
        }

        .text-error {
            color: red;
        }

        .alert.info {
            background-color: #d9edf7;
            color: #31708f;
        }

        .alert.error {
            background-color: #f2dede;
            color: #a94442;
        }

        .alert.success {
            background-color: #dff0d8;
            color: #3c763d;
        }

        .alert.warning {
            background-color: #fcf8e3;
            color: #8a6d3b;
        }

        .alert.danger {
            background-color: #f2dede;
            color: #a94442;
        }

        .form-label {
            font-size: 12px;
            color: #333;
            min-width: 70px;
            text-align: right;
            margin: 0;
        !important
        }

        table a {
            color: #007bff;
            text-decoration: none;
        }

        .form-control::placeholder {
            color: #aaa;
            opacity: 1;
        }

        .basic-line {
            border: 1px solid #0a0a0a;
            padding: 0;
            margin-bottom: 10px;
        }

        #tax_type_form {
            width: 200px;
        }

        #description_form {
            width: 200px;
        }

        #tax_form {
            width: 100px;
        }
    </style>
{% endblock stylesheets %}

{% block content %}
    {% load static %}
    <h2 class="h4">{{ label }}</h2>

    <hr class="basic-line">
    <div class="container" style="margin-bottom: 2vh">
        <div class='get_form'>
            <form method="GET" id="taxForm">
                <div class="form-group" style="display: inline-flex">
                    <label for="tax_type_form" style="padding-right: 20px">Tax Type:</label>
                    <select name="tax_type" id="tax_type_form" class="form-control" required>
                        <option value="sales_taxes" {% if tax_type == 'sales_taxes' %} selected{% endif %}>Sales
                            Taxes
                        </option>
                        <option value="purchase_taxes" {% if tax_type == 'purchase_taxes' %} selected{% endif %}>
                            Purchase Taxes
                        </option>
                    </select>
                </div>
            </form>
        </div>
        <form method="post" action="{% url 'setup_tax_structure' %}">

            <div class="post_form" style="padding: 10px">
                <div class="row" style="justify-content: end">
                    <div class="col-auto">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </div>
            {% if messages %}
                {% for message in messages %}
                    <div class="d-flex justify-content-center">
                        <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"
                                    aria-label="Close"></button>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
            {% csrf_token %}

            {{ tax_structure_formset.management_form }}

            <div class="card border-0 shadow mb-4">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-centered table-nowrap mb-0 rounded">
                            <thead class="thead-light">
                            <tr>
                                <th class="border-0 rounded-start">#</th>
                                <th class="border-0">Tax ID</th>
                                <th class="border-0">Description</th>
                                <th class="border-0">SGST</th>
                                <th class="border-0">CGST</th>
                                <th class="border-0">IGST</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!-- Item -->
                            {% for form in tax_structure_formset %}
                                {% include 'billing/form_errors.html' with form=form %}

                                {% if forloop.counter <= 10 %}
                                    <tr>
                                        <td>
                                            {{ forloop.counter }}
                                        </td>
                                        <td class="form-group">
                                            {{ form.tax_id }}
                                        </td>
                                        <td class="form-group">
                                            {{ form.description }}
                                        </td>
                                        <td class="form-group">
                                            {{ form.sgst }}
                                        </td>
                                        <td class="form-group">
                                            {{ form.cgst }}

                                        </td>
                                        <td class="form-group">
                                            {{ form.igst }}
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>


        </form>
    </div>
{% endblock %}
{% block javascripts %}
    <script>
        document.getElementById('tax_type_form').addEventListener('change', function () {
            document.getElementById('taxForm').submit();
        });
    </script>
{% endblock %}